<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - Error Dev</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="storage/internal/page-styles.css">
    <script src="storage/internal/embed-detect.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<body>
    <div class="page-container">
        <h1 class="page-title">Projects</h1>
        
        <div class="project-tabs" id="project-tabs"></div>
        
        <div id="tab-container"></div>
    </div>
    
    <script>
        let currentTab = null;

        async function loadYAML(path) {
            const response = await fetch(path);
            const text = await response.text();
            return jsyaml.load(text);
        }

        function renderTabs(tabs) {
            const tabsContainer = document.getElementById('project-tabs');
            
            Object.keys(tabs).forEach(tabKey => {
                const tabData = tabs[tabKey];
                const tabBtn = document.createElement('button');
                tabBtn.className = 'project-tab';
                tabBtn.textContent = tabData.display;
                tabBtn.onclick = () => switchTab(tabKey);
                tabBtn.dataset.tab = tabKey;
                
                tabsContainer.appendChild(tabBtn);
            });
        }

        function renderTabContent(tabKey, tabData) {
            const container = document.getElementById('tab-container');
            
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-content';
            tabContent.dataset.tab = tabKey;
            
            const projectsGrid = document.createElement('div');
            projectsGrid.className = 'projects-grid';
            
            tabData.projects.forEach(project => {
                const card = document.createElement('div');
                card.className = 'project-card';
                
                const title = document.createElement('a');
                title.className = 'project-title';
                title.href = project.link;
                title.target = '_blank';
                title.rel = 'noopener noreferrer';
                title.textContent = project.name;
                
                const description = document.createElement('div');
                description.className = 'project-description';
                description.textContent = project.description;
                
                card.appendChild(title);
                card.appendChild(description);
                projectsGrid.appendChild(card);
            });
            
            tabContent.appendChild(projectsGrid);
            container.appendChild(tabContent);
        }

        function switchTab(tabKey) {
            currentTab = tabKey;
            
            console.log('Switching to tab:', tabKey);
            document.querySelectorAll('.project-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabKey);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.dataset.tab === tabKey);
            });
            window.parent.location.hash = `page=projects&tab=${tabKey}`;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const data = await loadYAML('storage/data/projects.yaml');
                
                console.log('Projects data loaded:', data);
                
                if (!data || !data.projects || !data.projects.tabs) {
                    console.error('No projects data found');
                    return;
                }
                
                const tabs = data.projects.tabs;
                renderTabs(tabs);
                Object.keys(tabs).forEach(tabKey => {
                    renderTabContent(tabKey, tabs[tabKey]);
                });
                const hash = window.location.hash.substring(1);
                if (hash) {
                    const params = new URLSearchParams(hash);
                    const tab = params.get('tab');
                    
                    if (tab && tabs[tab]) {
                        switchTab(tab);
                    } else {
                        switchTab(Object.keys(tabs)[0]);
                    }
                } else {
                    switchTab(Object.keys(tabs)[0]);
                }
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        });
    </script>
</body>
</html>